




## ã€Segumi OS ç•ªç»„è®¡åˆ’(Segumi Obsidian System)ã€‘
```dataviewjs
// --- é€šç”¨å‡½æ•°ï¼šåˆ›å»ºæŒ‰é’® ---
function createButton(container, text, onClick) {
  const button = container.createEl('button', { text: text });
  button.onclick = onClick;
  return button;
}

// --- é€šç”¨å‡½æ•°ï¼šåˆ›å»ºç¬”è®°å®¹å™¨ ---
function createNoteContainer(container) {
  return container.createEl('div', { cls: 'note-container' });
}

// --- é€šç”¨å‡½æ•°ï¼šæ·»åŠ  CSS æ ·å¼ ---
function addStyle(styleContent) {
  const style = document.createElement('style');
  style.textContent = styleContent;
  document.head.append(style);
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 1 ---
async function è¡¨æ ¼1(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 1 çš„ä»£ç 
/**
 * ä»é“¾æ¥ä¸­æå– Subject IDã€‚
 * @param {string} link - è¦æå– ID çš„é“¾æ¥ã€‚
 * @returns {string|null} æå–çš„ Subject IDï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› nullã€‚
 */
function extractSubjectID(link) {
    if (!link) return null;
    const match = link.match(/subject\/(\d+)/);
    return match ? match[1] : null;
}

/**
 * è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é¡µé¢æ•°æ®ã€‚
 */
const pages = dv.pages('"è—ä¹¦é˜/é˜…è¯»"')
    .where(p => p.å¼€å§‹æ—¶é—´ >= 5 && p.ç»“æŸæ—¶é—´ < 5)
    .sort(p => p.å¼€å§‹æ—¶é—´, 'desc');

/**
 * è¿‡æ»¤å‡ºåŒ…å«å¼€å§‹æ—¶é—´å’Œç§ç±»çš„å®Œæ•´é¡µé¢æ•°æ®ã€‚
 */
const completePages = pages;

/**
 * åˆå§‹åŒ–è¡¨æ ¼æ•°æ®æ•°ç»„ï¼Œä¸åŒ…å«è¡¨å¤´ã€‚
 */
let tableData = [];

/**
 * ç”¨äºå­˜å‚¨å·²å¤„ç†çš„ä¸»ç±»åˆ«åŠå…¶å¯¹åº”çš„é¡µé¢æ•°æ®ã€‚
 */
const categoryMap = {};

/**
 * éå†æ‰€æœ‰é¡µé¢ï¼Œå¤„ç†ç§ç±»åŠå…¶å­æ ‡ç­¾ã€‚
 */
completePages.forEach(p => {
    let category = p["ç§ç±»"];
    if (category) {
        // å¦‚æœç§ç±»åŒ…å«â€œ/â€ï¼Œåˆ™è®¤ä¸ºæ˜¯å­æ ‡ç­¾ï¼Œæå–ä¸»æ ‡ç­¾
        if (category.includes("/")) {
            const parts = category.split("/");
            category = parts[0].trim(); // è·å–ä¸»æ ‡ç­¾
        }
        // å¦‚æœä¸»æ ‡ç­¾ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„æ¡ç›®
        if (!categoryMap[category]) {
            categoryMap[category] = [];
        }
        categoryMap[category].push(p); // å°†é¡µé¢æ•°æ®æ·»åŠ åˆ°å¯¹åº”ä¸»æ ‡ç­¾ä¸‹
    }
});

/**
 * æ ¹æ®å¤„ç†åçš„åˆ†ç±»æ•°æ®ç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚
 */
for (const category in categoryMap) {
    const categoryPages = categoryMap[category];

    tableData.push([`**${category}**`, "", "", "", ""]);

    categoryPages.forEach(p => {
        const subjectID = extractSubjectID(p.é“¾æ¥);
        const bgmLink = subjectID ? `[bgm${subjectID}](https://bgm.tv/subject/${subjectID})` : "";

        let launchButton = '';
        const encodedPath = encodeURI(p.file.path);

        const originalCategory = p["ç§ç±»"]; // è·å–åŸå§‹ç§ç±»ä¿¡æ¯

        if (originalCategory === "è§†è§‰å°è¯´" || originalCategory === "æ¸¸æˆ" || originalCategory === "RPG" || originalCategory === "æ¼«ç”»") {
            const launchLink = subjectID ? `localexplorer:${encodeURI(`F:\\Games\\galgame\\bgm${subjectID}`)}` : '';
            if (launchLink) launchButton = `[å¯åŠ¨](${launchLink})`;
        } else if (originalCategory === "ç½‘è¯¾") {
            launchButton = `[å¯åŠ¨](${p["é“¾æ¥"]})`;
        } else if (originalCategory === "åŠ¨ç”»") {
            const encodedAHKPath = encodeURI(`file:///D:/Tools/Autohotkey/æ‰“å¼€åŠ¨ç”»æ”¾æ˜ å™¨.ahk`);
            launchButton = `[å¯åŠ¨](${encodedAHKPath})`;
        }

        const titleLink = `[${p["æ ‡é¢˜"]}](${encodedPath})`;

        tableData.push([
            launchButton,
            titleLink,
            `[${originalCategory}](${p["é“¾æ¥"]})`,
            p["å¼€å§‹æ—¶é—´"],
            bgmLink
        ]);
    });
}

// è°ƒç”¨ dv.table å‡½æ•°æ—¶æ‰‹åŠ¨æ·»åŠ è¡¨å¤´
dv.table(
    ["å¯åŠ¨", "æ ‡é¢˜", "ç§ç±»", "å¼€å§‹æ—¶é—´", "Bangumi ID"],
    tableData
);
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 2 ---
async function è¡¨æ ¼2(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 2 çš„ä»£ç 
  /**
 * ä»é“¾æ¥ä¸­æå– Subject IDã€‚
 * @param {string} link - è¦æå– ID çš„é“¾æ¥ã€‚
 * @returns {string|null} æå–çš„ Subject IDï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› nullã€‚
 */
function extractSubjectID(link) {
    if (!link) return null;
    const match = link.match(/subject\/(\d+)/);
    return match ? match[1] : null;
}

/**
 * è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é¡µé¢æ•°æ®ã€‚
 */
const pages = dv.pages('"è—ä¹¦é˜/é˜…è¯»"')
    .where(p => p.å¼€å§‹æ—¶é—´ < 5 && p.ç»“æŸæ—¶é—´ < 5)
    .sort(p => p.å¼€å§‹æ—¶é—´, 'desc');

/**
 * è¿‡æ»¤å‡ºåŒ…å«å¼€å§‹æ—¶é—´å’Œç§ç±»çš„å®Œæ•´é¡µé¢æ•°æ®ã€‚
 */
const completePages = pages;

/**
 * åˆå§‹åŒ–è¡¨æ ¼æ•°æ®æ•°ç»„ï¼Œä¸åŒ…å«è¡¨å¤´ã€‚
 */
let tableData = [];

/**
 * ç”¨äºå­˜å‚¨å·²å¤„ç†çš„ä¸»ç±»åˆ«åŠå…¶å¯¹åº”çš„é¡µé¢æ•°æ®ã€‚
 */
const categoryMap = {};

/**
 * éå†æ‰€æœ‰é¡µé¢ï¼Œå¤„ç†ç§ç±»åŠå…¶å­æ ‡ç­¾ã€‚
 */
completePages.forEach(p => {
    let category = p["ç§ç±»"];
    if (category) {
        // å¦‚æœç§ç±»åŒ…å«â€œ/â€ï¼Œåˆ™è®¤ä¸ºæ˜¯å­æ ‡ç­¾ï¼Œæå–ä¸»æ ‡ç­¾
        if (category.includes("/")) {
            const parts = category.split("/");
            category = parts[0].trim(); // è·å–ä¸»æ ‡ç­¾
        }
        // å¦‚æœä¸»æ ‡ç­¾ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„æ¡ç›®
        if (!categoryMap[category]) {
            categoryMap[category] = [];
        }
        categoryMap[category].push(p); // å°†é¡µé¢æ•°æ®æ·»åŠ åˆ°å¯¹åº”ä¸»æ ‡ç­¾ä¸‹
    }
});

/**
 * æ ¹æ®å¤„ç†åçš„åˆ†ç±»æ•°æ®ç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚
 */
for (const category in categoryMap) {
    const categoryPages = categoryMap[category];

    tableData.push([`**${category}**`, "", "", "", ""]);

    categoryPages.forEach(p => {
        const subjectID = extractSubjectID(p.é“¾æ¥);
        const bgmLink = subjectID ? `[bgm${subjectID}](https://bgm.tv/subject/${subjectID})` : "";

        let launchButton = '';
        const encodedPath = encodeURI(p.file.path);

        const originalCategory = p["ç§ç±»"]; // è·å–åŸå§‹ç§ç±»ä¿¡æ¯

        if (originalCategory === "è§†è§‰å°è¯´" || originalCategory === "æ¸¸æˆ" || originalCategory === "RPG" || originalCategory === "æ¼«ç”»") {
            const launchLink = subjectID ? `localexplorer:${encodeURI(`F:\\Games\\galgame\\bgm${subjectID}`)}` : '';
            if (launchLink) launchButton = `[å¯åŠ¨](${launchLink})`;
        } else if (originalCategory === "ç½‘è¯¾") {
            launchButton = `[å¯åŠ¨](${p["é“¾æ¥"]})`;
        } else if (originalCategory === "åŠ¨ç”»") {
            const encodedAHKPath = encodeURI(`file:///D:/Tools/Autohotkey/æ‰“å¼€åŠ¨ç”»æ”¾æ˜ å™¨.ahk`);
            launchButton = `[å¯åŠ¨](${encodedAHKPath})`;
        }

        const titleLink = `[${p["æ ‡é¢˜"]}](${encodedPath})`;

        tableData.push([
            launchButton,
            titleLink,
            `[${originalCategory}](${p["é“¾æ¥"]})`,
            p["å¼€å§‹æ—¶é—´"],
            bgmLink
        ]);
    });
}

// è°ƒç”¨ dv.table å‡½æ•°æ—¶æ‰‹åŠ¨æ·»åŠ è¡¨å¤´
dv.table(
    ["å¯åŠ¨", "æ ‡é¢˜", "ç§ç±»", "å¼€å§‹æ—¶é—´", "Bangumi ID"],
    tableData
);
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 3 ---
async function è¡¨æ ¼3(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 3 çš„ä»£ç 
/**
 * ä»é“¾æ¥ä¸­æå– Subject IDã€‚
 * @param {string} link - è¦æå– ID çš„é“¾æ¥ã€‚
 * @returns {string|null} æå–çš„ Subject IDï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› nullã€‚
 */
function extractSubjectID(link) {
    if (!link) return null;
    const match = link.match(/subject\/(\d+)/);
    return match ? match[1] : null;
}

/**
 * è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é¡µé¢æ•°æ®ã€‚
 */
const pages = dv.pages('"è—ä¹¦é˜/é˜…è¯»"')
    .where(p => p.å¼€å§‹æ—¶é—´ >= 5 && p.ç»“æŸæ—¶é—´ >= 5)
    .sort(p => p.å¼€å§‹æ—¶é—´, 'desc');

/**
 * è¿‡æ»¤å‡ºåŒ…å«å¼€å§‹æ—¶é—´å’Œç§ç±»çš„å®Œæ•´é¡µé¢æ•°æ®ã€‚
 */
const completePages = pages;

/**
 * åˆå§‹åŒ–è¡¨æ ¼æ•°æ®æ•°ç»„ï¼Œä¸åŒ…å«è¡¨å¤´ã€‚
 */
let tableData = [];

/**
 * ç”¨äºå­˜å‚¨å·²å¤„ç†çš„ä¸»ç±»åˆ«åŠå…¶å¯¹åº”çš„é¡µé¢æ•°æ®ã€‚
 */
const categoryMap = {};

/**
 * éå†æ‰€æœ‰é¡µé¢ï¼Œå¤„ç†ç§ç±»åŠå…¶å­æ ‡ç­¾ã€‚
 */
completePages.forEach(p => {
    let category = p["ç§ç±»"];
    if (category) {
        // å¦‚æœç§ç±»åŒ…å«â€œ/â€ï¼Œåˆ™è®¤ä¸ºæ˜¯å­æ ‡ç­¾ï¼Œæå–ä¸»æ ‡ç­¾
        if (category.includes("/")) {
            const parts = category.split("/");
            category = parts[0].trim(); // è·å–ä¸»æ ‡ç­¾
        }
        // å¦‚æœä¸»æ ‡ç­¾ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„æ¡ç›®
        if (!categoryMap[category]) {
            categoryMap[category] = [];
        }
        categoryMap[category].push(p); // å°†é¡µé¢æ•°æ®æ·»åŠ åˆ°å¯¹åº”ä¸»æ ‡ç­¾ä¸‹
    }
});

/**
 * æ ¹æ®å¤„ç†åçš„åˆ†ç±»æ•°æ®ç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚
 */
for (const category in categoryMap) {
    const categoryPages = categoryMap[category];

    tableData.push([`**${category}**`, "", "", "", ""]);

    categoryPages.forEach(p => {
        const subjectID = extractSubjectID(p.é“¾æ¥);
        const bgmLink = subjectID ? `[bgm${subjectID}](https://bgm.tv/subject/${subjectID})` : "";

        let launchButton = '';
        const encodedPath = encodeURI(p.file.path);

        const originalCategory = p["ç§ç±»"]; // è·å–åŸå§‹ç§ç±»ä¿¡æ¯

        if (originalCategory === "è§†è§‰å°è¯´" || originalCategory === "æ¸¸æˆ" || originalCategory === "RPG" || originalCategory === "æ¼«ç”»") {
            const launchLink = subjectID ? `localexplorer:${encodeURI(`F:\\Games\\galgame\\bgm${subjectID}`)}` : '';
            if (launchLink) launchButton = `[å¯åŠ¨](${launchLink})`;
        } else if (originalCategory === "ç½‘è¯¾") {
            launchButton = `[å¯åŠ¨](${p["é“¾æ¥"]})`;
        } else if (originalCategory === "åŠ¨ç”»") {
            const encodedAHKPath = encodeURI(`file:///D:/Tools/Autohotkey/æ‰“å¼€åŠ¨ç”»æ”¾æ˜ å™¨.ahk`);
            launchButton = `[å¯åŠ¨](${encodedAHKPath})`;
        }

        const titleLink = `[${p["æ ‡é¢˜"]}](${encodedPath})`;

        tableData.push([
            launchButton,
            titleLink,
            `[${originalCategory}](${p["é“¾æ¥"]})`,
            p["å¼€å§‹æ—¶é—´"],
            bgmLink
        ]);
    });
}

// è°ƒç”¨ dv.table å‡½æ•°æ—¶æ‰‹åŠ¨æ·»åŠ è¡¨å¤´
dv.table(
    ["å¯åŠ¨", "æ ‡é¢˜", "ç§ç±»", "å¼€å§‹æ—¶é—´", "Bangumi ID"],
    tableData
);
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 4 ---
async function è¡¨æ ¼4(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 4 çš„ä»£ç 
  // Function to extract the Bangumi subject ID from the URL
function extractSubjectID(link) {
  if (!link) return null; // Check if the link is defined
  const match = link.match(/subject\/(\d+)/);
  return match ? match[1] : null;
}

// Get all pages that match the query and are not done
const pages = dv.pages('"è—ä¹¦é˜/é˜…è¯»"')
  .where(p => !p.done);

// Prepare the table data for software file names and corresponding titles
let tableData = [];

// Filter pages that have a BGM link and are not "åŠ¨ç”»"
const softwarePages = pages.where(p => {
  const subjectID = extractSubjectID(p.é“¾æ¥);
  return subjectID && p["ç§ç±»"] !== "åŠ¨ç”»"&& p["ç§ç±»"] !== "æ¸¸æˆ";
});

// Iterate over the filtered pages and extract the file names (bgm<subjectID>) and titles
softwarePages.forEach(p => {
  const subjectID = extractSubjectID(p.é“¾æ¥);
  if (subjectID) {
    const fileName = `bgm${subjectID}`;
    const title = p["æ ‡é¢˜"]; // Get the corresponding title
    tableData.push([fileName, title]);
  }
});

// Create a table with the file names and corresponding titles
dv.table(
  ["è½¯ä»¶æ–‡ä»¶åç§°", "å¯¹åº”åç§°"], // Table headers
  tableData
);
}

// --- ä¸»è¦é€»è¾‘ ---
const container = dv.el('div');

// åˆ›å»ºæŒ‰é’®å®¹å™¨
const buttonContainer = container.createEl('div');

// åˆ›å»ºç¬”è®°å®¹å™¨
const noteContainer = createNoteContainer(container);

// åˆ›å»ºæŒ‰é’®å¹¶ç»‘å®šäº‹ä»¶
createButton(buttonContainer, 'è¿›è¡Œä¸­', () => è¡¨æ ¼1(noteContainer));
createButton(buttonContainer, 'æ„¿æœ›å•', () => è¡¨æ ¼2(noteContainer));
createButton(buttonContainer, 'å·²å®Œæˆ', () => è¡¨æ ¼3(noteContainer));
createButton(buttonContainer, 'æç½®', () => è¡¨æ ¼4(noteContainer));

// åˆå§‹åŒ–ç‰¹å®šè¡¨æ ¼
//è¡¨æ ¼3(noteContainer);

// æ·»åŠ  CSS æ ·å¼
addStyle(`
  button {
    padding: 10px 20px;
    margin-right: 10px;
    cursor: pointer;
  }

  .note-container {
    margin-top: 10px; /* æ·»åŠ æŒ‰é’®å’Œå†…å®¹ä¹‹é—´çš„é—´è· */
  }
`);
```
```dataviewjs
// å‡½æ•°ï¼šä» URL ä¸­æå– Bangumi æ¡ç›® ID
function extractSubjectID(link) {
    if (!link) return null;
    const match = link.match(/subject\/(\d+)/);
    return match ? match[1] : null;
}

// å‡½æ•°ï¼šæ ¹æ®é¡µé¢ç§ç±»åˆ›å»ºå¯åŠ¨æŒ‰é’®ï¼Œä½¿ç”¨åŠ¨æ€åŒ¹é…
function createLaunchButton(page) {
    let launchButton = '';
    const subjectID = extractSubjectID(page.é“¾æ¥);
    const encodedPath = encodeURI(page.file.path);
    const category = page["ç§ç±»"];

    if (category) {
        // åŠ¨æ€åŒ¹é…è§„åˆ™ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šè§„åˆ™
        if (category === "è§†è§‰å°è¯´" || category === "æ¸¸æˆ" || category === "RPG" || category === "æ¼«ç”»") {
            const launchLink = subjectID ? `localexplorer:${encodeURI(`F:\\Games\\galgame\\bgm${subjectID}`)}` : '';
            if (launchLink) launchButton = `[å¯åŠ¨](${launchLink})`;
        } else if (category === "ç½‘è¯¾") {
            launchButton = `[å¯åŠ¨](${page["é“¾æ¥"]})`;
        } else if (category === "åŠ¨ç”»") {
            const encodedAHKPath = encodeURI(`file:///D:/Tools/Autohotkey/æ‰“å¼€åŠ¨ç”»æ”¾æ˜ å™¨.ahk`);
            launchButton = `[å¯åŠ¨](${encodedAHKPath})`;
        }
         // æ·»åŠ æ›´å¤šè‡ªå®šä¹‰ç§ç±»çš„å¯åŠ¨æ–¹å¼...
    }
    return launchButton;
}

// å‡½æ•°ï¼šæ¸²æŸ“â€œæœ€è¿‘æ·»åŠ â€éƒ¨åˆ†
function renderRecentItems(pages) {
    let tableData = [];
    tableData.push(["**æœ€è¿‘æ·»åŠ **", "", "", "", ""]);

    const recentItems = pages
        .limit(8); // ç›´æ¥é™åˆ¶æ•°é‡ï¼Œä¸è¿›è¡Œç§ç±»è¿‡æ»¤

    recentItems.forEach(p => {
        const subjectID = extractSubjectID(p.é“¾æ¥);
        const bgmLink = subjectID ? `[bgm${subjectID}](https://bgm.tv/subject/${subjectID})` : "";
        const launchButton = createLaunchButton(p);
        const titleLink = `[${p["æ ‡é¢˜"]}](${encodeURI(p.file.path)})`;
        const category = p["ç§ç±»"] || "å…¶ä»–"; // å¦‚æœæ²¡æœ‰ç§ç±»ï¼Œæ˜¾ç¤ºä¸ºâ€œå…¶ä»–â€

        tableData.push([
            launchButton,
            titleLink,
            category ? `[${category}](${p["é“¾æ¥"]})` : "",
            p["å¼€å§‹æ—¶é—´"],
            bgmLink
        ]);
    });

    tableData.push(["---", "---", "---", "---", "---"]);
    return tableData;
}

// ä¸»å‡½æ•°
function main() {
    // è·å–æ‰€æœ‰åŒ¹é…æŸ¥è¯¢ä¸”çŠ¶æ€ä¸ºâ€œè¿›è¡Œä¸­â€çš„é¡µé¢ï¼Œå¹¶æŒ‰å¼€å§‹æ—¶é—´é™åºæ’åºï¼Œå¤„ç†åŒ…å«ç©ºæ ¼çš„æ–‡ä»¶è·¯å¾„
    const pages = dv.pages('"è—ä¹¦é˜/é˜…è¯»"')
        .where(p => p.å¼€å§‹æ—¶é—´ >= 5 && p.ç»“æŸæ—¶é—´ < 5)
        .sort(p => p.å¼€å§‹æ—¶é—´, 'desc');

    // ç›´æ¥è·å–å®Œæ•´çš„é¡µé¢ï¼Œä¸å†åˆ†ç¦»ä¿¡æ¯ç¼ºå¤±çš„é¡µé¢
    const completePages = pages;

    // è·å–â€œæœ€è¿‘æ·»åŠ â€éƒ¨åˆ†çš„è¡¨æ ¼æ•°æ®
    const recentTableData = renderRecentItems(completePages);

    // æ¸²æŸ“è¡¨æ ¼
    dv.table(
        ["å¯åŠ¨", "æ ‡é¢˜", "ç§ç±»", "å¼€å§‹æ—¶é—´", "Bangumi ID"],
        recentTableData
    );
}

// æ‰§è¡Œä¸»å‡½æ•°
main();
```
# ã€å…¶ä»–å°ç»„ä»¶ã€‘
```dataviewjs
// --- é€šç”¨å‡½æ•°ï¼šåˆ›å»ºæŒ‰é’® ---
function createButton(container, text, onClick) {
  const button = container.createEl('button', { text: text });
  button.onclick = onClick;
  return button;
}

// --- é€šç”¨å‡½æ•°ï¼šåˆ›å»ºç¬”è®°å®¹å™¨ ---
function createNoteContainer(container) {
  return container.createEl('div', { cls: 'note-container' });
}

// --- é€šç”¨å‡½æ•°ï¼šæ·»åŠ  CSS æ ·å¼ ---
function addStyle(styleContent) {
  const style = document.createElement('style');
  style.textContent = styleContent;
  document.head.append(style);
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 1 ---
async function è¡¨æ ¼1(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 1 çš„ä»£ç 
  let pages = dv.pages('"è—ä¹¦é˜/æ—¥è®°"')
    .where(p => p.file.cday <= dv.date("today"))
    .sort(p => p.file.name, 'desc');

  if (pages.length === 0) {
    dv.paragraph("æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ—¥è®°ã€‚");
    return;
  }

  dv.table(
    ["æ—¥è®°é“¾æ¥", "æ ‡é¢˜", "è¯„åˆ†", "äº‹ä»¶", "å¾…åŠ", "æ ‡ç­¾"], 
    pages.map(p => [
      p.file.link,
      p.æ ‡é¢˜,
      p.è¯„åˆ†,
      p.äº‹ä»¶,
      p.å¾…åŠ,
      p.tags
    ])
  );
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 2 ---
async function è¡¨æ ¼2(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 2 çš„ä»£ç 
  dv.paragraph(`![[æ›´æ–°éšæƒ³.canvas]]`); 
}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 3 ---
async function è¡¨æ ¼3(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 3 çš„ä»£ç 

}

// --- å‡½æ•°ï¼šè¡¨æ ¼ 4 ---
async function è¡¨æ ¼4(noteContainer) {
  dv.paragraph(""); // æ¸…ç©ºæ—§çš„å†…å®¹
  // åœ¨è¿™é‡Œæ·»åŠ è¡¨æ ¼ 4 çš„ä»£ç 
  dv.paragraph(`![[ç»Ÿè®¡å¤‡ä»½.canvas]]`); // æ˜¾ç¤ºéšç¬”
}

// --- ä¸»è¦é€»è¾‘ ---
const container = dv.el('div');

// åˆ›å»ºæŒ‰é’®å®¹å™¨
const buttonContainer = container.createEl('div');

// åˆ›å»ºç¬”è®°å®¹å™¨
const noteContainer = createNoteContainer(container);

// åˆ›å»ºæŒ‰é’®å¹¶ç»‘å®šäº‹ä»¶
createButton(buttonContainer, 'æ—¥è®°', () => è¡¨æ ¼1(noteContainer));
createButton(buttonContainer, 'æ›´æ–°éšæƒ³', () => è¡¨æ ¼2(noteContainer));
createButton(buttonContainer, 'å¹´åº¦æ€»ç»“', () => è¡¨æ ¼3(noteContainer));
createButton(buttonContainer, 'ç»Ÿè®¡å¤‡ä»½', () => è¡¨æ ¼4(noteContainer));

// åˆå§‹åŒ–æ˜¾ç¤ºè¡¨æ ¼ 3 (æ˜¾ç¤ºå›¾ç‰‡)
///è¡¨æ ¼3(noteContainer);

// æ·»åŠ  CSS æ ·å¼
addStyle(`
  button {
    padding: 10px 20px;
    margin-right: 10px;
    cursor: pointer;
  }

  .note-container {
    margin-top: 10px; /* æ·»åŠ æŒ‰é’®å’Œå†…å®¹ä¹‹é—´çš„é—´è· */
  }
`);
```
```dataviewjs
let today = moment().format("YYYY-MM-DD");
let thisMonth = moment().month(); 
let thisYear = moment().year();

let pages = dv.pages('"è—ä¹¦é˜/æ—¥è®°"').where(p => p.file.cday);

let tasksWithDates = [];
for (let page of pages) {
  let date = page.file.name.slice(0, 10);
  let daysDiff = moment(date).diff(moment(today), 'days');

  if (daysDiff >= 0) {
    let tasks = page.å¾…åŠ;
    if (tasks) {
      if (Array.isArray(tasks)) {
        for (let task of tasks) {
          tasksWithDates.push({ task: task, date: date, daysDiff: daysDiff });
        }
      } else {
        tasksWithDates.push({ task: tasks, date: date, daysDiff: daysDiff });
      }
    }
  }
}

tasksWithDates.sort((a, b) => a.daysDiff - b.daysDiff);

// è·å–èŠ‚å‡æ—¥ä¿¡æ¯
let holidays = {};
async function fetchHolidays(year) {
  try {
    let response = await fetch(`http://timor.tech/api/holiday/year/${year}/`);
    let data = await response.json();
    if (data.code === 0) {
      holidays = data.holiday;
    } else {
      console.error(`è·å– ${year} å¹´èŠ‚å‡æ—¥ä¿¡æ¯å¤±è´¥: ${data.msg}`);
    }
  } catch (error) {
    console.error(`è·å– ${year} å¹´èŠ‚å‡æ—¥ä¿¡æ¯å¤±è´¥: ${error}`);
  }
}

await fetchHolidays(thisYear); // è·å–ä»Šå¹´çš„èŠ‚å‡æ—¥ä¿¡æ¯


function generateCalendar(year, month) {
  let calendarMonth = moment(new Date(year, month, 1)); 
  let daysInMonth = calendarMonth.daysInMonth();
  let firstDayOfMonth = calendarMonth.startOf('month').day(); 

  let calendar = `<td style="border: 1px solid #ccc; padding: 10px;">`; 
  calendar += `<table style='width:100%; border-collapse: collapse; transform: scale(1.0); transform-origin: top left;'>`; // å°†è¡¨æ ¼ç¼©å°åˆ°åŸæ¥çš„ 90%
  calendar += `<tr style='font-weight: bold; text-align: center;'><td colspan="7">${calendarMonth.format("MM æœˆ")}</td></tr>`; 
  calendar += "<tr style='font-weight: bold; background-color: #f2f2f2;'><td>Â Â Â Â æ—¥</td><td>Â ä¸€</td><td>Â äºŒ</td><td>Â ä¸‰</td><td>Â å››</td><td>Â äº”</td><td>Â å…­</td></tr>";

  let currentDay = 1;
  for (let week = 0; week < 6; week++) {
    calendar += "<tr>";
    for (let day = 0; day < 7; day++) {
      if (week === 0 && day < firstDayOfMonth) {
        calendar += "<td style='background-color: #f2f2f2; border: 1px solid #e0e0e0;'></td>"; 
      } else if (currentDay > daysInMonth) {
        calendar += "<td style='background-color: #f2f2f2; border: 1px solid #e0e0e0;'></td>";
      } else {
        let taskContent = "";
        let cellDate = calendarMonth.startOf('month').add(currentDay - 1, 'days').format("YYYY-MM-DD");

        tasksWithDates.forEach(taskData => {
          if (taskData.date === cellDate) {
            let color = "red"; // é»˜è®¤é¢œè‰²
            let fontSize = "10px";
            let fontWeight = "normal";
            if (taskData.daysDiff === 0) {
              color = "red";
              fontSize = "10px";
              fontWeight = "bold";
              taskContent += `<span style="color:${color}; font-size: ${fontSize}; font-weight: ${fontWeight};">â° ${taskData.task}</span><br>`;
            } else {
              taskContent += `<span style="color:${color}; font-size: ${fontSize};"> ${taskData.task}</span><br>`;
            }
          }
        });

        // æ£€æŸ¥æ—¥æœŸæ˜¯å¦ä¸ºèŠ‚å‡æ—¥
        let isHoliday = false;
        let holidayName = "";
        if (holidays[cellDate.slice(5)]) {
          isHoliday = holidays[cellDate.slice(5)].holiday;
          holidayName = holidays[cellDate.slice(5)].name;
        }

        // é«˜äº®ä»Šå¤©çš„æ—¥æœŸæ¡†å’ŒèŠ‚å‡æ—¥
        let cellStyle = "";
        if (cellDate === today) {
          cellStyle = "background-color: #d3d3d3; border: 2px solid #000;";
        } else if (isHoliday) {
          cellStyle = "background-color: #fcfcfc; border: 0px solid #000;";
        } else {
          cellStyle = "border: 1px solid #ddd; padding: 5px; vertical-align: top;";
        }
        calendar += `<td style='${cellStyle}'>${currentDay}<br>${taskContent}${isHoliday ? `<span style="color: blue;">${holidayName}</span>` : ''}</td>`;
        currentDay++;
      }
    }
    calendar += "</tr>";
  }
  calendar += `</table></td>`; 
  return calendar;
}

// æ¸²æŸ“æœ¬æœˆåŠä¹‹å 12 ä¸ªæœˆçš„æ—¥å†
let calendarHTML = `<table style='width:100%; border-collapse: collapse;'><tr><td style="background-color: #ddd; font-weight: bold; text-align: center; vertical-align: middle; width: 5%;">${thisYear} å¹´</td>`; 
let currentYear = thisYear;
for (let i = 0; i < 12; i++) {
  let year = thisYear;
  let month = thisMonth + i;
  if (month >= 12) {
    year += 1;
    month -= 12;
  }

  // æ·»åŠ å¹´ä»½æ ‡é¢˜
  if (year !== currentYear) {
    currentYear = year;
    // å¦‚æœæ˜¯æ–°çš„ä¸€å¹´ï¼Œéœ€è¦è·å–æ–°ä¸€å¹´çš„èŠ‚å‡æ—¥ä¿¡æ¯
    await fetchHolidays(year);
    calendarHTML += `<td style="background-color: #ddd; font-weight: bold; text-align: center; vertical-align: middle; width: 5%;">${currentYear} å¹´</td>`; 
  }
  calendarHTML += generateCalendar(year, month);
}
calendarHTML += `</tr></table>`;

dv.paragraph(`<div style="width: 100%; height: 100%;">${calendarHTML}</div>`);
```

```contributionGraph
title: Contributions
graphType: default
dateRangeValue: 365
dateRangeType: LATEST_DAYS
startOfWeek: 0
showCellRuleIndicators: true
titleStyle:
  textAlign: left
  fontSize: 15px
  fontWeight: normal
dataSource:
  type: PAGE
  value: '"è—ä¹¦é˜/é˜…è¯»"'
  dateField:
    type: FILE_CTIME
  filters: []
  countField:
    type: DEFAULT
fillTheScreen: false
enableMainContainerShadow: false
cellStyle:
  minWidth: 29px
  minHeight: 13px
cellStyleRules: []

```

```dataviewjs
  let now = new Date();

  let year = now.getFullYear();
  let month = now.getMonth() + 1;
  let date = now.getDate();
  let day = now.getDay();
  let hour = now.getHours();
  let minute = now.getMinutes();

  let dayOfWeek = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];

  let timePeriod = "";
  let formattedHour = hour;
  let amPm = "AM";

  if (hour >= 12) {
    amPm = "PM";
    if (hour > 12) {
      formattedHour -= 12;
    }
  }

  if (hour == 0) {
    formattedHour = 12;
  }

  if (hour >= 23 || hour < 2) {
    timePeriod = "æ·±å¤œ";
  } else if (hour >= 2 && hour < 5) {
    timePeriod = "å‡Œæ™¨";
  } else if (hour >= 5 && hour < 6) {
    timePeriod = "æ¸…æ™¨";                 
  } else if (hour >= 6 && hour < 9) {
    timePeriod = "æ—©æ™¨";
  } else if (hour >= 9 && hour < 12) {
    timePeriod = "ä¸Šåˆ";
  } else if (hour >= 12 && hour < 13) {
    timePeriod = "ä¸­åˆ";
  } else if (hour >= 13 && hour < 17) {
    timePeriod = "ä¸‹åˆ";
  } else if (hour >= 17 && hour < 19) {
    timePeriod = "å‚æ™š";
  } else {
    timePeriod = "æ™šä¸Š";
  }

  // è·å–å‡†ç¡®çš„emojiæ—¶é’Ÿ
  let clockEmoji = "";
  let hourForEmoji = (hour % 12); // è·å– 0-11 çš„å°æ—¶æ•°ï¼Œç”¨äºè®¡ç®— emoji
  if (minute >= 45) {
    hourForEmoji = (hourForEmoji + 1) % 12; // æŒ‡å‘ä¸‹ä¸€ä¸ªå°æ—¶
  }
  if (hourForEmoji === 0) {
    hourForEmoji = 12; // å°† 0 è°ƒæ•´ä¸º 12ï¼Œå› ä¸º Unicode ç ç‚¹ä¸­ 12 ç‚¹å¯¹åº”çš„æ˜¯ 0
  }
  clockEmoji = String.fromCodePoint(0x1F550 + hourForEmoji - 1); // ä½¿ç”¨ Unicode ç ç‚¹è®¡ç®— emoji


let today = moment().format("YYYY-MM-DD");
let pages = dv.pages('"è—ä¹¦é˜/æ—¥è®°"').where(p => p.file.cday);

let tasksWithDates = [];
for (let page of pages) {
  let date = page.file.name.slice(0, 10);
  let daysDiff = moment(date).diff(moment(today), 'days');

  // åªæ˜¾ç¤ºä»Šå¤©ä»¥åçš„å¾…åŠäº‹é¡¹
  if (daysDiff >= 0) {
    let tasks = page.å¾…åŠ;
    if (tasks) {
      if (Array.isArray(tasks)) {
        for (let task of tasks) {
          tasksWithDates.push({ task: task, date: date, daysDiff: daysDiff });
        }
      } else {
        tasksWithDates.push({ task: tasks, date: date, daysDiff: daysDiff });
      }
    }
  }
}

// æŒ‰æ—¥æœŸä»è¿‘åˆ°è¿œæ’åº
tasksWithDates.sort((a, b) => a.daysDiff - b.daysDiff);

// è·å–èŠ‚å‡æ—¥ä¿¡æ¯
let holidayData = await fetch("http://timor.tech/api/holiday/year/" + year + "/").then(res => res.json());
let holidays = holidayData.holiday;

let result = "";
for (let taskData of tasksWithDates) {
  let color = "";
  let fontSize = "25px";
  let fontWeight = "normal";
  if (taskData.daysDiff >= 30) {
    color = "black";
  } else if (taskData.daysDiff >= 7) {
    color = "blue";
  } else if (taskData.daysDiff >= 3) {
    color = "purple";
  } else {
    color = "red";
  }

  // å¦‚æœæ˜¯ä»Šå¤©ï¼Œåˆ™ç”¨æ›´å¤§çš„çº¢è‰²å­—ä½“åŠ ç²—æ˜¾ç¤º
  if (taskData.daysDiff === 0) {
    color = "red";
    fontSize = "35px";
    fontWeight = "bold";
    result += `<span style="color:${color}; font-family: æ¥·ä½“; font-size: ${fontSize}; font-weight: ${fontWeight};text-decoration: underline;">â°Â ä»Šå¤© ${taskData.task}ï¼ˆ${taskData.date}ï¼‰ </span><br>`;
  } else if (taskData.daysDiff === 1) { 
    color = "red";
    fontSize = "35px";
    fontWeight = "bold";
    result += `<span style="color:${color}; font-family: æ¥·ä½“; font-size: ${fontSize}; font-weight: ${fontWeight};text-decoration: underline;">ğŸš¨Â æ˜å¤© ${taskData.task}ï¼ˆ${taskData.date}ï¼‰ </span><br>`;
  } else if (taskData.daysDiff === 2) { 
    color = "red";
    fontSize = "35px";
    result += `<span style="color:${color}; font-family: æ¥·ä½“; font-size: ${fontSize};">Â Â Â Â åå¤© ${taskData.task}ï¼ˆ${taskData.date}ï¼‰ </span><br>`;
  } else if (taskData.daysDiff <= 3) { 
    color = "red";
    fontSize = "30px";
    result += `<span style="color:${color}; font-family: æ¥·ä½“; font-size: ${fontSize};">Â Â Â Â Â ${taskData.daysDiff}å¤©å ${taskData.task}ï¼ˆ${taskData.date}ï¼‰ </span><br>`;
  } else {
    result += `<span style="color:${color}; font-family: æ¥·ä½“; font-size: ${fontSize};">Â Â Â Â Â Â ${taskData.daysDiff}å¤©å ${taskData.task}ï¼ˆ${taskData.date}ï¼‰ </span><br>`;
  }
}

// å­˜å‚¨å·²ç»æ˜¾ç¤ºçš„èŠ‚å‡æ—¥ï¼Œé¿å…é‡å¤æ˜¾ç¤º
let displayedHolidays = [];

// æ·»åŠ èŠ‚å‡æ—¥ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºåé¢çš„ä¸‰ä¸ªèŠ‚å‡æ—¥
let holidayCount = 0; // è®¡æ•°å™¨ï¼Œç”¨äºé™åˆ¶æ˜¾ç¤ºçš„èŠ‚å‡æ—¥æ•°é‡
for (let date in holidays) {
  if (holidayCount >= 3) { // åªæ˜¾ç¤ºä¸‰ä¸ªèŠ‚å‡æ—¥
    break;
  }
  let holiday = holidays[date];
  if (holiday.holiday && !displayedHolidays.includes(holiday.name)) { // é¿å…é‡å¤æ˜¾ç¤º
    let holidayDate = moment(holiday.date);
    let daysDiff = holidayDate.diff(moment(today), 'days');

    // åªæ˜¾ç¤ºå‡æœŸå¤§äº1å¤©çš„èŠ‚å‡æ—¥
    if (holiday.rest > 1) {
      // åªæ˜¾ç¤ºè·ç¦»èŠ‚å‡æ—¥ç¬¬ä¸€å¤©çš„æ—¶é—´ï¼ˆç¬¬ä¸€å¤©ä¹‹åä¸æ˜¾ç¤ºï¼‰
      if (daysDiff >= 0) {
        result += `<span style="font-family: æ¥·ä½“; font-size: 25px;">Â Â Â Â Â Â è·ç¦» ${holiday.name}å‡æœŸ è¿˜æœ‰ ${daysDiff}å¤© ï¼ˆ${holiday.date}ï¼‰</span><br>`;
        displayedHolidays.push(holiday.name); // å°†å·²æ˜¾ç¤ºçš„èŠ‚å‡æ—¥æ·»åŠ åˆ°æ•°ç»„ä¸­
        holidayCount++; // å¢åŠ è®¡æ•°å™¨
      } 
    }
  }
}

dv.paragraph(`<span style="font-family: ä¼˜è®¾é²¨é±¼è²ç‰¹å¥åº·ä½“; font-size: 50px; line-height: 75px;">${clockEmoji} ç°åœ¨æ˜¯ ${year}å¹´${month}æœˆ${date}æ—¥ ${dayOfWeek[day]} ${timePeriod} ${String(formattedHour).padStart(2, '0')}:${String(minute).padStart(2, '0')} ${amPm}.</span><br>${result}`);
```
```dataviewjs
// è·å–æ‰€æœ‰é¡µé¢ï¼Œç­›é€‰å¼€å§‹æ—¥æœŸå’Œå®Œæˆæ—¥æœŸéƒ½ä¸ä¸ºç©ºçš„é¡¹ç›®
const pages = dv.pages('"è—ä¹¦é˜/é˜…è¯»"')
  .where(p => p.å¼€å§‹æ—¶é—´ != null && (p.ç»“æŸæ—¶é—´ != null || p.ç»“æŸæ—¶é—´ == ""));

// æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®
if (pages.length === 0) {
  dv.paragraph("ç»§ç»­åŠ æ²¹åŠªåŠ›å§");
} else {
  // å­˜å‚¨æ²¡æœ‰è¯„ä»·å’Œæ²¡æœ‰æ‰“åˆ†çš„æ¸¸æˆ
  let noCommentGames = [];
  let noScoreGames = [];

  pages.forEach(p => {
    const encodedPath = encodeURI(p.file.path);
    const titleLink = `[${p["æ ‡é¢˜"]}](${encodedPath})`;

    // æ£€æŸ¥è¯„ä»·
    if (!p["è¯„ä»·"]) {
      noCommentGames.push(titleLink);
    }

    // æ£€æŸ¥æ‰“åˆ†ï¼ˆå‡è®¾æ‰“åˆ†å­—æ®µåä¸ºâ€œè¯„åˆ†â€ï¼‰
    if (!p["è¯„åˆ†"]) {
      noScoreGames.push(titleLink);
    }
  });

  // æ˜¾ç¤ºæ²¡æœ‰è¯„ä»·çš„æç¤ºå’Œæ¸¸æˆ
  if (noCommentGames.length > 0) {
    dv.paragraph("è¯´ç‚¹ä»€ä¹ˆå§");
    dv.list(noCommentGames);
  }

  // æ˜¾ç¤ºæ²¡æœ‰æ‰“åˆ†çš„æç¤ºå’Œæ¸¸æˆ
  if (noScoreGames.length > 2) {
    dv.paragraph("è¿˜æ²¡æœ‰æ‰“åˆ†å“¦");
    dv.list(noScoreGames);
  }
}
```

```dataview
table without ID  link(file.link, æ ‡é¢˜) as æ ‡é¢˜, "[" + ç§ç±» + "](" + é“¾æ¥ + ")" as ç§ç±», ç”¨æ—¶, è¯„åˆ†, å¼€å§‹æ—¶é—´, ç»“æŸæ—¶é—´, done as "å®ŒæˆçŠ¶æ€"
from "è—ä¹¦é˜/é˜…è¯»"
sort å¼€å§‹æ—¶é—´ asc
WHERE done = true
```


- ä¸ç”¨çš„ç»„ä»¶


